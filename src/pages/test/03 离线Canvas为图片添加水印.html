<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>03 离线Canvas为图片添加水印</title>
	<style type="text/css">
		*{margin: 0; padding: 0;}
		#canvas{
			border: 2px solid #000;
		}
		input{
			display: block;
			margin-top: 20px;
			width:300px;
		}
	</style>
</head>
<body>
	<canvas id='canvas'></canvas>
	<input type="range" id='scale-range' min='0.1' max='1.5' step='0.01' value='1'>
	<canvas id="watermark-canvas" style="display:none;">
        您的浏览器尚不支持canvas
    </canvas>
	
	

	<script type="text/javascript">

		var canvas = document.getElementById("canvas");
		var context = canvas.getContext('2d');
		var slider = document.getElementById("scale-range");
		var img = new Image();

		var watermarkCanvas = document.getElementById("watermark-canvas")
        var watermarkContext = watermarkCanvas.getContext("2d")

		window.onload = function(){
			canvas.width = 300;	
			canvas.height = 300;

			var scale = slider.value;

			img.src = 'image/01 .jpg';
			// 图片加载完后，将其显示在canvas中
			img.onload = function(){
			    drawImageByScale(scale);
			    slider.onmousemove = function(){
			    	scale = slider.value;
			    	drawImageByScale(scale);
			    }
			}
			// 绘制水印
			watermarkCanvas.width = 300
            watermarkCanvas.height = 100

            watermarkContext.font = "bold 20px Arial"
            watermarkContext.lineWidth = "1"
            watermarkContext.fillStyle = "rgba( 255 , 255 , 255 , 0.5 )"
            watermarkContext.textBaseline = "middle";
            watermarkContext.fillText( "== liuyubobobo.com ==" , 50, 70 )
		}
		function drawImageByScale(scale){
			var imgWidth = 640*scale;
			var imgHeight = 640*scale;

			var dx = canvas.width/2 - imgWidth/2;
			var dy = canvas.height/2 - imgHeight/2;
			context.clearRect(0, 0, canvas.width, canvas.height);
			context.drawImage(img, dx, dy, imgWidth, imgHeight);
			context.drawImage( watermarkCanvas , canvas.width - watermarkCanvas.width ,
                                                  canvas.height - watermarkCanvas.height )
		}
		
		

	</script>
</body>
</html>
